<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Java 源码学习系列2——Integer | Thpffcj的树洞</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Hexo">
    <meta name="author" content="John Doe">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Thpffcj</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2017-10-01T02:01:37.000Z" itemprop="datePublished">
          2017-10-01
      </time>
    
</span>
                <h1>Java 源码学习系列2——Integer</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="1-Integer-类的定义"><a href="#1-Integer-类的定义" class="headerlink" title="1. Integer 类的定义"></a>1. Integer 类的定义</h2><pre><code>public final class Integer extends Number implements Comparable&lt;Integer&gt;
</code></pre><ul>
<li>Integer类不能被继承</li>
<li>Integer类实现了Comparable接口，所以可以用compareTo进行比较并且Integer对象只能和Integer类型的对象进行比较，不能和其他类型比较（至少调用compareTo方法无法比较）。</li>
<li>Integer继承了Number类，Number为抽象类，提供了实数基本类型的互相转换方法：int,long,short,byte,float,double<br>Number的基本实现类有java.lang.Byte，java.lang.Double，java.lang.Float，java.lang.Integer，java.lang.Long，java.lang.Short等。</li>
</ul>
<h2 id="2-String-类的属性"><a href="#2-String-类的属性" class="headerlink" title="2. String 类的属性"></a>2. String 类的属性</h2><pre><code>// 一个私有属性——value属性就是Integer对象中真正保存int值的。
private final int value;

// serialVersionUID和序列化有关。
private static final long serialVersionUID = 1360826667806852920L;

// 值为 （－（2的31次方）） 的常量，它表示 int 类型能够表示的最小值。
public static final int   MIN_VALUE = 0x80000000;

// 值为 （（2的31次方）－1） 的常量，它表示 int 类型能够表示的最大值。
public static final int   MAX_VALUE = 0x7fffffff;

// 表示基本类型 int 的 Class 实例。
public static final Class&lt;Integer&gt;  TYPE = (Class&lt;Integer&gt;) Class.getPrimitiveClass(&quot;int&quot;);

// 用来以二进制补码形式表示 int 值的比特位数。
public static final int SIZE = 32;

// 用来以二进制补码形式表示 int 值的字节数。
public static final int BYTES = SIZE / Byte.SIZE;
</code></pre><h2 id="3-String-类的构造方法"><a href="#3-String-类的构造方法" class="headerlink" title="3. String 类的构造方法"></a>3. String 类的构造方法</h2><p>Integer提供了两个构造方法：</p>
<pre><code>//构造一个新分配的 Integer 对象，它表示指定的 int 值。
public Integer(int value) {
    this.value = value;
}

//构造一个新分配的 Integer 对象，它表示 String 参数所指示的 int 值。
public Integer(String s) throws NumberFormatException {
    this.value = parseInt(s, 10);
}
</code></pre><h2 id="4-String-类的常用的方法"><a href="#4-String-类的常用的方法" class="headerlink" title="4. String 类的常用的方法"></a>4. String 类的常用的方法</h2><h3 id="1-valueOf"><a href="#1-valueOf" class="headerlink" title="1. valueOf"></a>1. valueOf</h3><p>源码中有一个IntegerCache，这一个私有的内部类。这个类缓存了low - high之间数字的包装类。如果判断成立就把缓存中的那个包装类返回，如果不则new一个新的。</p>
<pre><code>/**
 * @param  i an {@code int} value.
 * @return an {@code Integer} instance representing {@code i}.
 * @since  1.5
 */
public static Integer valueOf(int i) {
    if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
</code></pre><h3 id="2-IntegerCache"><a href="#2-IntegerCache" class="headerlink" title="2. IntegerCache"></a>2. IntegerCache</h3><p>这个类是私有的且是静态的，并且他有三个被final修饰的静态filed外加一个静态块和一个私有的构造器；很简单很普通的一个类，被缓存的包装类就介于low - high之间，low的值已经写死-128，而high的值由你的虚拟机决定sun.misc.VM.getSavedProperty(“java.lang.Integer.IntegerCache.high”)，既然是一个参数也就意味着你可以动态设置。然后在循环中将low - high之间数字的装箱后方法cache[]这个Integer类型的数组中。这样就完成了缓存。</p>
<pre><code>private static class IntegerCache {
    static final int low = -128; //默认low=-128
    static final int high; //high可以配置，通过 VM 参数-XX:AutoBoxCacheMax=&lt;size&gt;
        //high可以配置，所以默认缓存-128~127，但是也可以缓存另外的常用数。
    static final Integer cache[]; //缓存数组

    //静态代码块，Integer类加载时就缓存。
    static {
        // high value may be configured by property
        int h = 127; //默认127
        String integerCacheHighPropValue =
            sun.misc.VM.getSavedProperty(&quot;java.lang.Integer.IntegerCache.high&quot;); //读取VM参数配置。
        if (integerCacheHighPropValue != null) {
            try {
                int i = parseInt(integerCacheHighPropValue);
                i = Math.max(i, 127); //缓存大数
                // Maximum array size is Integer.MAX_VALUE
                h = Math.min(i, Integer.MAX_VALUE - (-low) -1); //防止越界
            } catch( NumberFormatException nfe) {
                // If the property cannot be parsed into an int, ignore it.
            }
        }
        high = h;

        cache = new Integer[(high - low) + 1]; //创建缓存数组。
        int j = low;
        for(int k = 0; k &lt; cache.length; k++)
            cache[k] = new Integer(j++); //缓存。

        // range [-128, 127] must be interned (JLS7 5.1.7)
        assert IntegerCache.high &gt;= 127; //保证[-128, 127]在缓存范围内。
    }

    private IntegerCache() {}
}
</code></pre><p>再回到valueOf代码，可以得出结论。当调用valueOf方法（包括后面会提到的重载的参数类型包含String的valueOf方法）时，如果参数的值在-127到128之间，则直接从缓存中返回一个已经存在的对象。如果参数的值不在这个范围内，则new一个Integer对象返回。</p>
<p>所以，当把一个int变量转成Integer的时候（或者新建一个Integer的时候），建议使用valueOf方法来代替构造函数。或者直接使用Integer i = 100;编译器会转成Integer s = Integer.valueOf(10000);</p>
<h3 id="3-String转成Integer（int）的方法"><a href="#3-String转成Integer（int）的方法" class="headerlink" title="3. String转成Integer（int）的方法"></a>3. String转成Integer（int）的方法</h3><pre><code>Integer getInteger(String nm)
Integer getInteger(String nm, int val)
Integer getInteger(String nm, Integer val)
Integer decode(String nm)
Integer valueOf(String s)
Integer valueOf(String s, int radix)
int parseUnsignedInt(String s)
int parseUnsignedInt(String s, int radix)
int parseInt(String s)
int parseInt(String s, int radix)
</code></pre><p>以上所有方法都能实现将String类型的值转成Integer(int)类型（如果 String 不包含可解析整数将抛出NumberFormatException）</p>
<p>可以说，所有将String转成Integer的方法都是基于parseInt方法实现的。简单看一下以上部分方法的调用栈。</p>
<pre><code>getInteger(String nm) ---&gt; getInteger(nm, null);---&gt;Integer.decode()---&gt;Integer.valueOf()---&gt;parseInt()
</code></pre><h3 id="4-getInteger"><a href="#4-getInteger" class="headerlink" title="4. getInteger"></a>4. getInteger</h3><p>方法确定具有指定名称的系统属性的整数值，先按照nm作为key从系统配置中取出值，然后调用Integer.decode方法将其转换成整数并返回。</p>
<pre><code>/**
 * @param   nm   property name.
 * @param   val   default value.
 * @return  the {@code Integer} value of the property.
 * @throws  SecurityException for the same reasons as
 *          {@link System#getProperty(String) System.getProperty}
 * @see     System#getProperty(String)
 * @see     System#getProperty(String, String)
 */
public static Integer getInteger(String nm, Integer val) {
    String v = null;
    try {
        v = System.getProperty(nm);
    } catch (IllegalArgumentException | NullPointerException e) {
    }
    if (v != null) {
        try {
            return Integer.decode(v);
        } catch (NumberFormatException e) {
        }
    }
    return val;
}
</code></pre><h3 id="5-decode"><a href="#5-decode" class="headerlink" title="5. decode"></a>5. decode</h3><p>解码字符串转换为整数。它接受十进制，十六进制，八进制数。NumberFormatException – 如果该串不包含一个可分析的整数。decode方法的具体实现也比较简单，首先就是判断String类型的参数mn是否以(+/—)符号开头。然后再依次判断是否以”0x”、“#”、“0”开头，确定基数说明符的值。然后将字符串mn进行截取，只保留其中纯数字部分。在用截取后的纯数字和基数调用valueOf(String s, int radix)方法并返回其值。</p>
<pre><code>/**
 * @param     nm the {@code String} to decode.
 * @return    an {@code Integer} object holding the {@code int}
 *             value represented by {@code nm}
 * @exception NumberFormatException  if the {@code String} does not
 *            contain a parsable integer.
 * @see Integer#parseInt(String, int)
 */
public static Integer decode(String nm) throws NumberFormatException {
    // nm由三部分组成：符号、基数说明符和字符序列。 —0X123中-是符号位，0X是基数说明符（0表示八进制，0x,0X，#表示十六进制，什么都不写则表示十进制），123是数字字符序列。
    int radix = 10;
    int index = 0;
    boolean negative = false;
    Integer result;

    if (nm.length() == 0)
        throw new NumberFormatException(&quot;Zero length string&quot;);
    char firstChar = nm.charAt(0);
    // Handle sign, if present
    if (firstChar == &apos;-&apos;) {
        negative = true;
        index++;
    } else if (firstChar == &apos;+&apos;)
        index++;

    // Handle radix specifier, if present
    if (nm.startsWith(&quot;0x&quot;, index) || nm.startsWith(&quot;0X&quot;, index)) {
        index += 2;
        radix = 16;
    }
    else if (nm.startsWith(&quot;#&quot;, index)) {
        index ++;
        radix = 16;
    }
    else if (nm.startsWith(&quot;0&quot;, index) &amp;&amp; nm.length() &gt; 1 + index) {
        index ++;
        radix = 8;
    }

    if (nm.startsWith(&quot;-&quot;, index) || nm.startsWith(&quot;+&quot;, index))
        throw new NumberFormatException(&quot;Sign character in wrong position&quot;);

    try {
        result = Integer.valueOf(nm.substring(index), radix);
        result = negative ? Integer.valueOf(-result.intValue()) : result;
    } catch (NumberFormatException e) {
        // If number is Integer.MIN_VALUE, we&apos;ll end up here. The next line
        // handles this case, and causes any genuine format error to be
        // rethrown.
        String constant = negative ? (&quot;-&quot; + nm.substring(index))
                                   : nm.substring(index);
        result = Integer.valueOf(constant, radix);
    }
    return result;
}
</code></pre><h3 id="6-parseInt"><a href="#6-parseInt" class="headerlink" title="6. parseInt"></a>6. parseInt</h3><pre><code>public static int parseInt(String s, int radix) throws NumberFormatException {
    //这里有这个警告是因为valueOf方法使用了parseInt方法和IntegerCache对象，
    //因为valueOf在IntegerCache初始化之前使用导致异常情况。后面会详细分析。
    /*
     * WARNING: This method may be invoked early during VM initialization
     * before IntegerCache is initialized. Care must be taken to not use
     * the valueOf method.
     */

    //下面三个if用来判断参数是否合法。radix大小在2~36之间。
    if (s == null) {
        throw new NumberFormatException(&quot;null&quot;);
    }
    if (radix &lt; Character.MIN_RADIX) {
        throw new NumberFormatException(&quot;radix &quot; + radix + &quot; less than Character.MIN_RADIX&quot;);
    }
    if (radix &gt; Character.MAX_RADIX) {
        throw new NumberFormatException(&quot;radix &quot; + radix + &quot; greater than Character.MAX_RADIX&quot;);
    }

    int result = 0; //解析结果
    boolean negative = false; //是否是负数
    int i = 0, len = s.length(); //索引变量和字符串长度
    int limit = -Integer.MAX_VALUE; //最大值限制
    int multmin; //基数下的最小值
    int digit; //记录每一位的数字

    if (len &gt; 0) {
        char firstChar = s.charAt(0);
        if (firstChar &lt; &apos;0&apos;) { // 判断是否带‘+’或‘-’
            if (firstChar == &apos;-&apos;) {
                negative = true;
                limit = Integer.MIN_VALUE;
            } else if (firstChar != &apos;+&apos;)
                throw NumberFormatException.forInputString(s);

            if (len == 1) // 格式非法，含有除了‘+’‘-’之外的字符。
                throw NumberFormatException.forInputString(s);
            i++;
        }
        multmin = limit / radix;
        while (i &lt; len) {
            //利用了Character类中的digit非法，作用是解析一个字符。
            digit = Character.digit(s.charAt(i++),radix);
            //进行异常判断。
            //这个解析字符串为数字的算法和平时想到的不太一样，是从字符串左边开始，初始化结果是0，
            //其实是把结果算成负的，返回的时候再转回来。result -= digit;
            if (digit &lt; 0) {
                throw NumberFormatException.forInputString(s);
            }
            if (result &lt; multmin) {
                throw NumberFormatException.forInputString(s);
            }
            result *= radix;
            if (result &lt; limit + digit) {
                throw NumberFormatException.forInputString(s);
            }
            result -= digit;
        }
    } else {
        throw NumberFormatException.forInputString(s);
    }
    return negative ? result : -result; //如果是负的就直接返回，因为算出来的已经是负数。
}
</code></pre><ul>
<li>如果只需要返回一个基本类型，而不需要一个对象，可以直接使用Integert.parseInt(“123”);</li>
<li>如果需要一个对象，那么建议使用valueOf(),因为该方法可以借助缓存带来的好处。</li>
<li>如果和进制有关，那么就是用decode方法。</li>
<li>如果是从系统配置中取值，那么就是用getInteger</li>
</ul>
<h3 id="7-int转成String的方法"><a href="#7-int转成String的方法" class="headerlink" title="7. int转成String的方法"></a>7. int转成String的方法</h3><pre><code>String  toString()
static String   toString(int i)
static String   toString(int i, int radix)
static String   toBinaryString(int i)
static String   toHexString(int i)
static String   toOctalString(int i)
static String   toUnsignedString(int i)
static String   toUnsignedString(int i, int radix)
</code></pre><h3 id="8-toString"><a href="#8-toString" class="headerlink" title="8. toString"></a>8. toString</h3><p>直接看toString方法，toString方法的定义比较简单，就是把一个int类型的数字转换成字符串类型，但是这个方法的实现调用了一系列方法。由于stringSize方法要求传入一个正整数，在调用该方法时需要将负数转成正数传入。将-2147483648的值直接返回的原因就是整数最大只能表示2147483647，无法将stringSize(-i)中的i赋值成-2147483648。</p>
<pre><code>/**
 * @param   i   an integer to be converted.
 * @return  a string representation of the argument in base&amp;nbsp;10.
 */
public static String toString(int i) {
    if (i == Integer.MIN_VALUE)
        return &quot;-2147483648&quot;;
    int size = (i &lt; 0) ? stringSize(-i) + 1 : stringSize(i);
    char[] buf = new char[size];
    getChars(i, size, buf);
    // 这里用到了一个String中提供的保护类型构造函数
    return new String(buf, true);
}

// Requires positive x
static int stringSize(int x) {
    for (int i=0; ; i++)
        if (x &lt;= sizeTable[i])
            return i+1;
}

final static int [] sizeTable = { 9, 99, 999, 9999, 99999, 999999, 9999999,
                                  99999999, 999999999, Integer.MAX_VALUE };
</code></pre><ul>
<li>局部性原理之空间局部性:sizeTable为数组，存储在相邻的位置，cpu一次加载一个块数据数据到cache中(多个数组数据)，此后访问sizeTable 不需要访问内存。</li>
<li>基于范围的查找，是很实用的设计技术。</li>
</ul>
<h3 id="9-getChars"><a href="#9-getChars" class="headerlink" title="9. getChars"></a>9. getChars</h3><pre><code>static void getChars(int i, int index, char[] buf) {
    int q, r;
    int charPos = index;
    char sign = 0;

    if (i &lt; 0) {
        sign = &apos;-&apos;;
        i = -i;
    }

    // Generate two digits per iteration
    // 每次循环过后，都会将i中的最后两位保存到字符数组buf中的最后两位中，读者可以将数字i设置为12345678测试一下， 
    // 第一次循环结束之后，buf[7] = 8,buf[6]=7。第二次循环结束之后，buf[5] = 6,buf[4] = 5。
    while (i &gt;= 65536) {
        q = i / 100;
    // really: r = i - (q * 100);
        r = i - ((q &lt;&lt; 6) + (q &lt;&lt; 5) + (q &lt;&lt; 2));
        i = q;
        // 取DigitOnes[r]的目的其实取数字r%10的结果
        buf [--charPos] = DigitOnes[r];
        // 取DigitTens[r]的目的其实是取数字r/10的结果
        buf [--charPos] = DigitTens[r];
    }

    // Fall thru to fast mode for smaller numbers
    // assert(i &lt;= 65536, i);
    // 循环将其他数字存入字符数组中空余位置
    for (;;) {
        // 这里其实就是除以10。
        q = (i * 52429) &gt;&gt;&gt; (16+3);
        r = i - ((q &lt;&lt; 3) + (q &lt;&lt; 1));  // r = i-(q*10) ...
        // 将数字i的最后一位存入字符数组，
        buf [--charPos] = digits [r];
        i = q;
        if (i == 0) break;
    }
    if (sign != 0) {
        buf [--charPos] = sign;
    }
}
</code></pre><p>方法会根据输入的数的数量级来采用不同的处理方法。</p>
<p>当i &gt;=65536时，以100为单位，通过i - ( i / 100 * 100 )的方式来获得最后两位，然后分别查DigitTens和DigitOnes两个表，直接获取十位和个位。</p>
<p>而为什么是当i<65536 时才换乘法应该是保证="" q="(i" *="" 52429)="">&gt;&gt; (16+3); 相乘时不会溢出吧  2^16 = 65535 而整数最大值是2^32。</65536></p>
<p>其中的(q &gt;&gt; 6) + (q &gt;&gt; 5) + (q &gt;&gt; 2)实际就是在计算q * 100，2 ^ 6 + 2 ^ 5 + 2 ^ 2 = 100。只不过移位的耗时更少而已。</p>
<p>当i &lt; 65536时，通过i - ( i / 10 * 10 )来获得每一位。</p>
<p>这里的 q = (i * 52429) &gt;&gt;&gt; (16+3)可能会让人费解，实际2 ^ 19 = 524288，而52429 / 524288 = 0.10000038146972656，约为0.1，所以这一步实际就是在除以10，只不过是换种效率更高的方法而已。</p>
<p>既然我们要使用q = (i <em> num2) &gt;&gt;&gt; (num3);的形式使用乘法和移位代替除法，那么n和m就要有这样的关系：num2= (2^num3 /10 +1)。只有这样才能保证(i </em> num2) &gt;&gt;&gt; (num3)结果接近于0.1。</p>
<pre><code>2^10=1024, 103/1024=0.1005859375
2^11=2048, 205/2048=0.10009765625
2^12=4096, 410/4096=0.10009765625
2^13=8192, 820/8192=0.10009765625
2^14=16384, 1639/16384=0.10003662109375
2^15=32768, 3277/32768=0.100006103515625
2^16=65536, 6554/65536=0.100006103515625
2^17=131072, 13108/131072=0.100006103515625
2^18=262144, 26215/262144=0.10000228881835938
2^19=524288, 52429/524288=0.10000038146972656
2^20=1048576, 104858/1048576=0.1000003815
2^21=2097152, 209716/2097152 = 0.1000003815
2^22= 4194304, 419431/4194304= 0.1000001431
</code></pre><p>那么是怎么敲定num1=65536,num2= 524288, num3=19的呢？<br>我认为有以下几个原因：</p>
<ol>
<li>52429/524288=0.10000038146972656精度足够高。</li>
<li>下一个精度较高的num2和num3的组合是419431和22。2^31/2^22 = 2^9 = 512。512这个数字实在是太小了。65536正好是2^16，一个整数占4个字节。65536正好占了2个字节，选定这样一个数字有利于CPU访问数据。</li>
</ol>
<p>其实65536<em> 52429是超过了int的最大值的，一旦超过就要溢出，那么为什么还能保证（num1</em> num2）&gt;&gt;&gt; num3能得到正确的结果呢？</p>
<p>这和&gt;&gt;&gt;有关，因为&gt;&gt;&gt;表示无符号右移，他会在忽略符号位，空位都以0补齐。</p>
<p>一个有符号的整数能表示的范围是-2147483648至2147483647，但是无符号的整数能表示的范围就是0-4,294,967,296（2^32），所以，只要保证num2*num3的值不超过2^32次方就可以了。65536是2^16,52429正好小于2^16,所以，他们的乘积在无符号向右移位就能保证数字的准确性。</p>
<pre><code> // 100以内的数字除以10的结果（取整）
 final static char [] DigitTens = {
    &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;, &apos;0&apos;,
    &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;,
    &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;,
    &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;,
    &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;,
    &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;,
    &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;,
    &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;,
    &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;,
    &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;,
    } ;

// 100以内的数字对10取模的结果，
final static char [] DigitOnes = {
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;,
    } ;

final static char[] digits = {
    &apos;0&apos; , &apos;1&apos; , &apos;2&apos; , &apos;3&apos; , &apos;4&apos; , &apos;5&apos; ,
    &apos;6&apos; , &apos;7&apos; , &apos;8&apos; , &apos;9&apos; , &apos;a&apos; , &apos;b&apos; ,
    &apos;c&apos; , &apos;d&apos; , &apos;e&apos; , &apos;f&apos; , &apos;g&apos; , &apos;h&apos; ,
    &apos;i&apos; , &apos;j&apos; , &apos;k&apos; , &apos;l&apos; , &apos;m&apos; , &apos;n&apos; ,
    &apos;o&apos; , &apos;p&apos; , &apos;q&apos; , &apos;r&apos; , &apos;s&apos; , &apos;t&apos; ,
    &apos;u&apos; , &apos;v&apos; , &apos;w&apos; , &apos;x&apos; , &apos;y&apos; , &apos;z&apos;
};
</code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/wxisme/p/6308517.html" target="_blank" rel="external">JDK源码分析-Integer</a><br><a href="https://segmentfault.com/a/1190000007002125" target="_blank" rel="external">java.lang.Integer 源码深入解读</a><br><a href="http://www.hollischuang.com/archives/1058" target="_blank" rel="external">Java 源码学习系列（三）——Integer</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2017/10/01/ArrayList-Source-Code/" style="float: left;">
        ← Java 源码学习系列3——ArrayList
    </a>
    
    
    <a class="pull-right" href="/2017/09/30/String-Source-Code/">
        Java 源码学习系列1——String →
    </a>
    
</nav>

        <div class="duoshuo">


</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
				<span id="busuanzi_container_site_pv">
					本站总访问量<span id="busuanzi_value_site_pv"></span>次
				</span>	
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Thpffcj.
                </p>
                <p>私は再び1日満たすためにあなたとの重要な人々を望みます</p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- ============================ END Footer =========================== -->

      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      (function(){
        console.log('font');
        var getCss = function(path) {
          var head = document.getElementsByTagName('head')[0];
          link = document.createElement('link');
          link.href = path;
          link.rel = 'stylesheet';
          link.type = 'text/css';
          head.appendChild(link);
        };
        getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
        getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
      })();
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
