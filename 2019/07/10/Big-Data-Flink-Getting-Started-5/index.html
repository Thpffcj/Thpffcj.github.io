<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Flink项目实战 | Thpffcj的树洞</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Hexo">
    <meta name="author" content="John Doe">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close">
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Thpffcj</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

</div>
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2019-07-10T00:40:46.000Z" itemprop="datePublished">
          2019-07-10
      </time>
    
</span>
                <h1>Flink项目实战</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<ul>
<li>下面是这段时间系统了解Flink的一些记录<ul>
<li><a href="http://www.thpffcj.com/2019/06/28/Big-Data-Flink-Getting-Started-1/" target="_blank" rel="noopener">初识Flink</a></li>
<li><a href="http://www.thpffcj.com/2019/06/29/Big-Data-Flink-Getting-Started-2" target="_blank" rel="noopener">DataSet &amp; DataStream API 编程</a></li>
<li><a href="http://www.thpffcj.com/2019/07/04/Big-Data-Flink-Getting-Started-3" target="_blank" rel="noopener">Flink Table API 和 Time 操作</a></li>
<li><a href="http://www.thpffcj.com/2019/07/07/Big-Data-Flink-Getting-Started-4" target="_blank" rel="noopener">Filnk Connectors 和部署</a></li>
<li><a href="http://www.thpffcj.com/2019/07/10/Big-Data-Flink-Getting-Started-5" target="_blank" rel="noopener">Flink项目实战</a></li>
</ul>
</li>
</ul>
<p>在学习完Flink的基本知识之后，我们需要用一个稍微真实一些的实战项目来了解如何开发一个Flink系统来解决我们生活中遇到的问题。</p>
<hr>
<h2 id="1-Flink项目实战"><a href="#1-Flink项目实战" class="headerlink" title="1. Flink项目实战"></a>1. Flink项目实战</h2><h3 id="1-项目背景"><a href="#1-项目背景" class="headerlink" title="1. 项目背景"></a>1. 项目背景</h3><p><strong>CDN</strong></p>
<ul>
<li>根据业务日志，按照需求，进行功能的实现</li>
<li>接入的数据类型就是日志<ul>
<li>离线：Flume =&gt; HDFS</li>
<li>实时：Kafka =&gt; 流处理引擎 =&gt; ES =&gt; Kibana</li>
</ul>
</li>
</ul>
<h3 id="2-功能描述"><a href="#2-功能描述" class="headerlink" title="2. 功能描述"></a>2. 功能描述</h3><ul>
<li>统计一分钟内每个域名访问产生的流量<ul>
<li>Flink接收Kafka的数据进行处理</li>
</ul>
</li>
<li>统计一分钟内每个用户产生的流量<ul>
<li>域名和用户是有对应关系的</li>
<li>Flink接收Kafka的数据 + Flink读取域名和用户的配置数据 进行处理</li>
</ul>
</li>
<li>数据来源：Mock</li>
</ul>
<h3 id="3-项目架构"><a href="#3-项目架构" class="headerlink" title="3. 项目架构"></a>3. 项目架构</h3><p><img src="https://raw.githubusercontent.com/Thpffcj/Thpffcj.github.io/master/picture/Big-Data-Flink-Getting-Started/项目架构.png" alt=""></p>
<h3 id="4-功能一实现"><a href="#4-功能一实现" class="headerlink" title="4. 功能一实现"></a>4. 功能一实现</h3><ul>
<li>Mock数据：务必掌握的<ul>
<li>数据敏感</li>
<li>多团队协作，你依赖了其他团队提供的服务或者接口</li>
<li>通过Mock的方式往kafka的broker里面发送数据</li>
</ul>
</li>
</ul>
<p><strong>kafka生产者代码</strong></p>
<ul>
<li>启动ZK</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ ./zkServer.sh start
</code></pre><ul>
<li>启动kafka</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ ./kafka-server-start.sh -daemon ~/Public/software/kafka_2.12-2.2.0/config/server.properties 

Thpffc:bin thpffcj$ ./kafka-topics.sh --list --zookeeper localhost:2181
__consumer_offsets
merchants-template
test
</code></pre><ul>
<li>编写kafka producer</li>
</ul>
<pre><code>public class MyKafkaProducer {

    public static void main(String[] args) throws Exception {

        Properties properties = new Properties();
        properties.setProperty(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        properties.setProperty(&quot;key.serializer&quot;, StringSerializer.class.getName());
        properties.setProperty(&quot;value.serializer&quot;, StringSerializer.class.getName());

        KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties);

        String topic = &quot;test&quot;;

        // 通过死循环一直不停的往Kafka的Broker里面生产数据
        while (true) {

            StringBuilder builder = new StringBuilder();

            builder.append(&quot;aliyun&quot;).append(&quot;\t&quot;)
                    .append(&quot;CN&quot;).append(&quot;\t&quot;)
                    .append(getLevels()).append(&quot;\t&quot;)
                    .append(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date())).append(&quot;\t&quot;)
                    .append(getIps()).append(&quot;\t&quot;)
                    .append(getDomains()).append(&quot;\t&quot;)
                    .append(getTraffic()).append(&quot;\t&quot;);

            System.out.println(builder.toString());
            producer.send(new ProducerRecord&lt;String, String&gt;(topic, builder.toString()));

            Thread.sleep(2000);
        }
    }

    private static long getTraffic() {
        return new Random().nextInt(10000);
    }

    private static String getDomains() {
        String[] domains = new String[] {
                &quot;v1.go2yd.com&quot;,
                &quot;v2.go2yd.com&quot;,
                &quot;v3.go2yd.com&quot;,
                &quot;v4.go2yd.com&quot;,
                &quot;vmi.go2yd.com&quot;
        };
        return domains[new Random().nextInt(domains.length)];
    }

    private static String getIps() {
        String[] ips = new String[] {
                &quot;223.104.18.110&quot;,
                &quot;113.101.75.194&quot;,
                &quot;27.17.127.135&quot;,
                &quot;183.225.139.16&quot;,
                &quot;112.1.66.34&quot;,
                &quot;175.148.211.190&quot;,
                &quot;183.227.58.21&quot;,
                &quot;59.83.198.84&quot;,
                &quot;117.28.38.28&quot;,
                &quot;117.59.39.169&quot;
        };
        return ips[new Random().nextInt(ips.length)];
    }

    // 生产level数据
    public static String getLevels() {
        String[] levels = new String[]{&quot;M&quot;, &quot;E&quot;};
        return levels[new Random().nextInt(levels.length)];
    }
}
</code></pre><ul>
<li>打开kafka consumer查看是否能接收到数据</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test
</code></pre><p><strong>使用flink消费kafka产生的数据</strong></p>
<pre><code>object LogAnalysis {

  def main(args: Array[String]): Unit = {

    val env = StreamExecutionEnvironment.getExecutionEnvironment

    val topic = &quot;test&quot;
    val properties = new Properties()
    properties.setProperty(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;)
    properties.setProperty(&quot;group.id&quot;, &quot;test-group&quot;)

    val consumer = new FlinkKafkaConsumer[String](topic, new SimpleStringSchema(), properties)

    // 接收kafka数据
    val data = env.addSource(consumer)

    data.print().setParallelism(1)

    env.execute(&quot;LogAnalysis&quot;)
  }
}
</code></pre><p><strong>使用flink完成日志清洗功能</strong></p>
<pre><code>// 在生产上记录日志建议采用这种方式
val logger = LoggerFactory.getLogger(&quot;LogAnalysis&quot;)

// 接收kafka数据
val data = env.addSource(consumer)

val logData = data.map(x =&gt; {
  val splits = x.split(&quot;\t&quot;)
  val level = splits(2)
  val timeStr = splits(3)
  var time = 0l

  try {
    val sourceFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;)
    time = sourceFormat.parse(timeStr).getTime
  } catch {
    case e: Exception =&gt; {
      logger.error(s&quot;time parse error: $timeStr&quot;, e.getMessage)
    }
  }

  val domain = splits(5)
  val traffic = splits(6).toLong

  (level, time, domain, traffic)
})
</code></pre><p><strong>清洗过程中添加业务逻辑条件的过滤</strong></p>
<ul>
<li>对于我们的业务来说，我们只需要统计level=E的即可，对于level非E的，不作为我们业务指标的统计范畴</li>
<li>我们还需要去除时间不符合规则的数据</li>
<li>在生产上进行业务处理的时候，一定要考虑处理的健壮性以及你数据的准确性，脏数据或者是不符合业务规则的数据是需要全部过滤掉之后，再进行业务逻辑的处理</li>
<li>数据清洗：就是按照我们的业务规则把原始输入的数据进行一定业务规则的处理使得满足我们的业务需求为准</li>
</ul>
<pre><code>val logData = data.map(x =&gt; {

  ...
  (level, time, domain, traffic)
}).filter(_._2 != 0).filter(_._1 == &quot;E&quot;)
    .map(x =&gt; {
      (x._2, x._3, x._4)  // 1 level(抛弃) 2 time 3 domain 4 traffic
    })
</code></pre><p><strong>Flink中Watermark的定义及使用</strong></p>
<pre><code>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)

logData.assignTimestampsAndWatermarks(new AssignerWithPeriodicWatermarks[(Long, String, String)] {

  val maxOutOfOrderness = 10000L

  var currentMaxTimestamp: Long = _

  override def getCurrentWatermark: Watermark = {
    new Watermark(currentMaxTimestamp - maxOutOfOrderness)
  }

  override def extractTimestamp(element: (Long, String, String), previousElementTimestamp: Long): Long = {
    val timestamp = element._1
    currentMaxTimestamp = Math.max(timestamp, currentMaxTimestamp)
    timestamp
  }
})
</code></pre><ul>
<li>代码中的extractTimestamp方法是从数据本身中提取EventTime</li>
<li>getCurrentWatermar方法是获取当前水位线，利用currentMaxTimestamp - maxOutOfOrderness</li>
<li>这里的maxOutOfOrderness表示是允许数据的最大乱序时间</li>
</ul>
<p><strong>WindowFunction业务逻辑的实现</strong></p>
<pre><code>val resultData = logData.assignTimestampsAndWatermarks(new AssignerWithPeriodicWatermarks[(Long, String, Long)] {

  ...

}).keyBy(1)  // 此处是按照域名进行KeyBy的
    .window(TumblingEventTimeWindows.of(Time.seconds(60)))
    .apply(new WindowFunction[(Long, String, Long), (String, String, Long), Tuple, TimeWindow] {
      override def apply(key: Tuple, window: TimeWindow, input: Iterable[(Long, String, Long)], out: Collector[(String, String, Long)]): Unit = {

        val domain = key.getField(0).toString
        var sum = 0l

        val iterator = input.iterator
        var inputTime = 0l
        while (iterator.hasNext) {
          val next = iterator.next()
          sum += next._3  // traffic求和
          inputTime = next._1
        }

        val resultFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm&quot;)
        val time = resultFormat.format(inputTime)

        /**
          * 第一个参数：这一分钟的时间 2019-09-09 20:20
          * 第二个参数：域名
          * 第三个参数：traffic的和
          */
        out.collect((time, domain, sum))
      }
    })
</code></pre><p><strong>ES部署</strong></p>
<ul>
<li>下载解压</li>
<li>修改配置文件elasticsearch.yml</li>
</ul>
<pre><code># Set the bind address to a specific IP (IPv4 or IPv6):
#
network.host: 0.0.0.0
</code></pre><ul>
<li>启动</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ ./elasticsearch -d
</code></pre><ul>
<li>我们可以访问9200端口查看基本信息</li>
</ul>
<p><strong>Kibana部署</strong></p>
<ul>
<li>下载解压</li>
<li>启动</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ ./kibana
</code></pre><ul>
<li>我们可以访问5601端口访问web界面</li>
</ul>
<p><strong>统计分析数据写入ES并通过Kibana展示出来</strong></p>
<ul>
<li>创建索引</li>
</ul>
<pre><code>Thpffc:bin thpffcj$ curl -XPUT &apos;http://localhost:9200/cdn&apos;
{&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;cdn&quot;}Thpffc:bin thpffcj$ 
</code></pre><ul>
<li>设置mapping</li>
</ul>
<pre><code>curl -H &quot;Content-Type: application/json&quot; -XPOST &apos;http://localhost:9200/cdn/traffic/_mapping?pretty&apos; -d &apos;
{
    &quot;traffic&quot;:{
        &quot;properties&quot;:{
            &quot;domain&quot;:{&quot;type&quot;:&quot;keyword&quot;},
            &quot;traffics&quot;:{&quot;type&quot;:&quot;long&quot;},
            &quot;time&quot;:{&quot;type&quot;:&quot;date&quot;,&quot;format&quot;:&quot;yyyy-MM-dd HH:mm&quot;}
        }
    }
}
&apos;
</code></pre><ul>
<li>开发代码，flink官网就有模板代码</li>
</ul>
<pre><code>// ES部分
val httpHosts = new java.util.ArrayList[HttpHost]
httpHosts.add(new HttpHost(&quot;127.0.0.1&quot;, 9200, &quot;http&quot;))

val esSinkBuilder = new ElasticsearchSink.Builder[(String, String, Long)](
  httpHosts,
  new ElasticsearchSinkFunction[(String, String, Long)] {
    def createIndexRequest(element: (String, String, Long)): IndexRequest = {
      val json = new java.util.HashMap[String, Any]
      json.put(&quot;time&quot;, element._1)
      json.put(&quot;domain&quot;, element._2)
      json.put(&quot;traffics&quot;, element._3)

      val id = element._1 + &quot;-&quot; + element._2

      return Requests.indexRequest()
        .index(&quot;cdn&quot;)
        .`type`(&quot;traffic&quot;)
        .id(id)
        .source(json)
    }

    override def process(t: (String, String, Long), runtimeContext: RuntimeContext, requestIndexer: RequestIndexer): Unit = {
      requestIndexer.add(createIndexRequest(t))
    }
  }
)

// configuration for the bulk requests; this instructs the sink to emit after every element, otherwise they would be buffered
esSinkBuilder.setBulkFlushMaxActions(1)

// finally, build and add the sink to the job&apos;s pipeline
resultData.addSink(esSinkBuilder.build)
</code></pre><p><strong>通过Kibana图形化展示ES中存储的结果</strong></p>
<ul>
<li>去Kinana中创建cdn的index pattern，接着就可以通过图形界面创建各种图表，非常方便</li>
</ul>
<p>！<a href="https://raw.githubusercontent.com/Thpffcj/Thpffcj.github.io/master/picture/Big-Data-Flink-Getting-Started/表格展示.png" target="_blank" rel="noopener"></a></p>
<h3 id="5-功能二实现"><a href="#5-功能二实现" class="headerlink" title="5. 功能二实现"></a>5. 功能二实现</h3><ul>
<li>需求：CDN业务<ul>
<li>userid对应多个域名</li>
<li>用户id和域名的映射关系：从日志里能拿到domain，还得从另外一个表(MySQL)里面去获取userid和domain的映射关系</li>
</ul>
</li>
</ul>
<pre><code>CREATE TABLE user_domain_config(
id int unsigned auto_increment,
user_id varchar(40) not null,
domain varchar(40) not null,
primary key(id)
);

insert into user_domain_config(user_id, domain) values(&apos;8000000&apos;, &apos;v1.go2yd.com&apos;);
insert into user_domain_config(user_id, domain) values(&apos;8000000&apos;, &apos;v2.go2yd.com&apos;);
insert into user_domain_config(user_id, domain) values(&apos;8000000&apos;, &apos;v3.go2yd.com&apos;);
insert into user_domain_config(user_id, domain) values(&apos;8000000&apos;, &apos;v4.go2yd.com&apos;);
insert into user_domain_config(user_id, domain) values(&apos;8000000&apos;, &apos;vmi.go2yd.com&apos;);
</code></pre><ul>
<li>在做实时数据清洗的时候，不仅需要处理raw日志，还需要关联MySQL表里的数据</li>
<li>自定义一个Flink去读MySQL数据的数据源，然后把两个Stream关联起来</li>
</ul>
<p><strong>自定义MySQL数据源</strong></p>
<pre><code>class MyMySQLSource extends RichParallelSourceFunction[mutable.HashMap[String, String]] {

  var connection:Connection = null
  var ps:PreparedStatement = null

  // open：建立连接
  override def open(parameters: Configuration): Unit = {

    val url = &quot;jdbc:mysql://localhost:3306/test&quot;
    val user = &quot;root&quot;
    val password = &quot;00000000&quot;
    connection = DriverManager.getConnection(url, user, password)

    val sql = &quot;select user_id, domain from user_domain_config&quot;
    ps = connection.prepareStatement(sql)
  }

  // 释放资源
  override def close(): Unit = {
    if (ps != null) {
      ps.close()
    }

    if (connection != null) {
      connection.close()
    }
  }

  /**
    * 此处是代码的关键：要从MySQL表中把数据读取出来转成Map进行数据的封装
    * @param ctx
    */
  override def run(ctx: SourceFunction.SourceContext[mutable.HashMap[String, String]]): Unit = {

    val resultMap = new mutable.HashMap[String, String]()

    val result = ps.executeQuery()
    while (result.next()) {
      val userId = result.getString(1)
      val domain = result.getString(2)
      resultMap.put(domain, userId)
    }
    ctx.collect(resultMap)
  }

  override def cancel(): Unit = {}
}
</code></pre><p><strong>两个流关联数据清洗</strong></p>
<pre><code>val mysqlData = env.addSource(new MyMySQLSource)

val connectData = logData.connect(mysqlData)
    .flatMap(new CoFlatMapFunction[(Long, String, Long), mutable.HashMap[String, String], String] {

      var userDomainMap = new mutable.HashMap[String, String]()

      // log
      override def flatMap1(value: (Long, String, Long), out: Collector[String]): Unit = {
        val domain = value._2
        val userId = userDomainMap.getOrElse(domain, &quot;&quot;)

        out.collect(value._1 + &quot;\t&quot; + value._2 + &quot;\t&quot; + value._3 + &quot;\t&quot; + userId)
      }

      // MySQL
      override def flatMap2(value: mutable.HashMap[String, String], out: Collector[String]): Unit = {
        userDomainMap = value
      }
    })

connectData.print().setParallelism(1)
</code></pre><h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><p>Flink进行数据的清洗</p>
<ul>
<li>读取Kafka的数据</li>
<li>读取MySQL的数据</li>
<li>connect</li>
<li>业务逻辑的处理分析：水印 WindowFunction</li>
<li>ES 注意数据类型 &lt;= Kibana 图形化的统计结果展示</li>
<li>Kibana：各个环节的监控，监控图形化</li>
</ul>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2020/01/01/置顶目录/" style="float: left;">
        ← 【置顶】 博客目录
    </a>
    
    
    <a class="pull-right" href="/2019/07/07/Big-Data-Flink-Getting-Started-4/">
        Filnk Connectors 和部署 →
    </a>
    
</nav>

        <div class="duoshuo">


</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
				<span id="busuanzi_container_site_pv">
					本站总访问量<span id="busuanzi_value_site_pv"></span>次
				</span>	
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Thpffcj.
                </p>
                <p>私は再び1日満たすためにあなたとの重要な人々を望みます</p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- ============================ END Footer =========================== -->

      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      (function(){
        console.log('font');
        var getCss = function(path) {
          var head = document.getElementsByTagName('head')[0];
          link = document.createElement('link');
          link.href = path;
          link.rel = 'stylesheet';
          link.type = 'text/css';
          head.appendChild(link);
        };
        getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
        getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
      })();
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
